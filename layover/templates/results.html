{% extends "layout.html" %}

{% block scripts %}
<script>var data = {{data|tojson}}</script>
<script type="text/javascript" src="{{ url_for('static', filename = 'constants.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename = 'buildTable.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename = 'results.js') }}"></script>
<script>
	// Reformat time displayed in the table
	function reformatTimeDisplay(format){
		allTimeDisplays = $('.timeDisplay')
		// Change everything into 24-hour format
		for (let i = 0; i < allTimeDisplays.length; i++) {
			let currentObj = allTimeDisplays[i]
			let currentObjTime = currentObj.innerHTML
			if (currentObjTime.indexOf(':') != -1) {
				continue
			}
			if (currentObjTime.indexOf('AM') != -1) {
				let hour = Number(currentObjTime.substring(0, currentObjTime.indexOf('AM')))
				if (hour == 12) {
					hour = 0
				}
				currentObjTime = hour.toString() + ':00'

			} else if (currentObjTime.indexOf('PM') != -1) {
				let hour = Number(currentObjTime.substring(0, currentObjTime.indexOf('PM')))
				if (hour != 12) {
					hour += 12
				}
				currentObjTime = hour.toString() + ':00'
			}
			currentObj.innerHTML = currentObjTime
		}

		// Format 24h to 12h if specified
		if (format === '12h') {
			for (let i = 0; i < allTimeDisplays.length; i++) {
				// Same logic as function in buildTable.js
				let currentObj = allTimeDisplays[i]
				let currentObjTime = currentObj.innerHTML
				let hour = Number(currentObjTime.substring(0, currentObjTime.indexOf(':')))
				if (hour < 12) {
					displayTime = hour == 0 ? 12: hour
					meridiem = 'AM'
				} else {
					displayTime = hour == 12 ? 12: hour - 12
					meridiem = 'PM'
				}
				currentObj.innerHTML = displayTime + ' ' + meridiem
			}
		}
	}

	// Change data in table
	function changeBoldEmail(email){
		let allEmails = $('#users-list > ul > li')
		// Ref: https://stackoverflow.com/questions/10877903/check-if-text-in-cell-is-bold
		for(let i = 0; i < allEmails.length; i++){
			let currentEmail = allEmails[i]
			// Unbold text
			if(currentEmail.firstChild.nodeName === 'b' || currentEmail.firstChild.nodeName === 'B'){
				currentEmail.innerHTML = currentEmail.innerText
			}
			// Bold text if match `email`
			if(currentEmail.innerText === email){
				currentEmail.innerHTML = '<b>' + currentEmail.innerText + '</b>'
			}
		}
		// Hacky way to change table display per participant by clicking #change_table 2 times
		$('#change_table').trigger('click')
		$('#change_table').trigger('click')
		
	}
</script>
{% endblock %}

{% block styling %}
.center-text {
	text-align: center;
}
body {
    <!-- background: #F2F2F2; -->
}
table {
	table-layout: fixed;
	text-align: center;
    border-collapse: collapse;
}
th, td {
    width: 2%;
}
td {
    background-clip: padding-box;
}
tr:not(:first-child) td:not(:first-child) {
    border-color: transparent;
    border-width: 2px;
    border-radius: 8px;
}
{% endblock %}

{% block content %}

<br><br>

<div class="row">

    <!-- <div class="row" id="curr_table_type">
		Current table: In-person availability
	</div>
	<div class="row" id="change_table_div">
		<div class="col-3">
			<button type="button" class="btn btn-primary" id="change_table">Click to go to virtual availability</button>
		</div>
	</div> -->

    <div class="col-6">
        <div class="row">
            <div class="col-5 col-form-label" id="curr_table_type">
                Viewing: In-person availability
            </div>
            <div class="col-4" style="margin-left: -20px;" id="change_table_div">
                <button type="button" class="btn btn-primary" id="change_table">Toggle: Virtual availability</button>
            </div>            
            <div id="timeFormatSelector" class="btn-group col-3" style="margin-left: 20px;"> <!-- Needs to be changed. -->
                <label class="btn btn-primary" onclick="reformatTimeDisplay('12h')">
                    <input type="radio" name="radio1" checked> 12-hr </input>
                </label>
                <label class="btn btn-primary" onclick="reformatTimeDisplay('24h')">
                    <input type="radio" name="radio1"> 24-hr </input>
                </label>
            </div>
        </div>
        <div id="sched-results" class="container ui_box"></div>
    </div>


    <div class="col-6">
        <div class="row">
            
            <div class="col-1"></div>
            <div class="col-5 ui_box">
                <h6><i class="fas fa-x fa-users"></i> &nbsp; Participants List</h6>
                <hr>
                <div id="users-list" class="container"></div>
            </div>

            <div class="col-5 ui_box">                
                <h6><i class="fas fa-x fa-clock"></i> &nbsp; Best Dates/Times</h6>
                <hr>
                <div id="best-times" class="container"></div>
            </div>
            
        </div>
        
        <div class="row">
            <div class="col-1"></div>
            <div class="col-10 ui_box">
                <h6>Click to copy/share meeting link:</h6>
                
            <div class="row ui_box" style="background-color: white;">
            <div class="col-10"><b id="meetingId"></b></div>
            <div class="col-2"><button type="button" class="btn btn-primary" id="copyBtn"><i class="fas fa-x fa-copy"></i></button></div>
            </div>
            <div class="col-2"></div>

			</div>
		</div>
		
        <div class="row">
			<div class="col-4"></div>
			<div class="col-4" style="margin-top: 10px;">
				<button type="button" class="btn btn-primary" id="editingPage">Go back to Editing Page</button>
			</div>
			
			<div class="col-4"></div>
		</div>
    </div>
</div>

{% endblock %}