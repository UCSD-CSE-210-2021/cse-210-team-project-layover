{% extends "layout.html" %}

{% block scripts %}
<script>var data = {{data|tojson}}</script>
<script type="text/javascript" src="{{ url_for('static', filename = 'constants.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename = 'buildTable.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename = 'results.js') }}"></script>
<script>
	// Reformat time displayed in the table
	function reformatTimeDisplay(format){
		allTimeDisplays = $('.timeDisplay')
		// Change everything into 24-hour format
		for (let i = 0; i < allTimeDisplays.length; i++) {
			let currentObj = allTimeDisplays[i]
			let currentObjTime = currentObj.innerHTML
			if (currentObjTime.indexOf(':') != -1) {
				continue
			}
			if (currentObjTime.indexOf('AM') != -1) {
				let hour = Number(currentObjTime.substring(0, currentObjTime.indexOf('AM')))
				if (hour == 12) {
					hour = 0
				}
				currentObjTime = hour.toString() + ':00'

			} else if (currentObjTime.indexOf('PM') != -1) {
				let hour = Number(currentObjTime.substring(0, currentObjTime.indexOf('PM')))
				if (hour != 12) {
					hour += 12
				}
				currentObjTime = hour.toString() + ':00'
			}
			currentObj.innerHTML = currentObjTime
		}

		// Format 24h to 12h if specified
		if (format === '12h') {
			for (let i = 0; i < allTimeDisplays.length; i++) {
				// Same logic as function in buildTable.js
				let currentObj = allTimeDisplays[i]
				let currentObjTime = currentObj.innerHTML
				let hour = Number(currentObjTime.substring(0, currentObjTime.indexOf(':')))
				if (hour < 12) {
					displayTime = hour == 0 ? 12: hour
					meridiem = 'AM'
				} else {
					displayTime = hour == 12 ? 12: hour - 12
					meridiem = 'PM'
				}
				currentObj.innerHTML = displayTime + ' ' + meridiem
			}
		}
	}

	// Change data in table
	function changeBoldEmail(email){
		let allEmails = $('#users-list > ul > li')
		// Ref: https://stackoverflow.com/questions/10877903/check-if-text-in-cell-is-bold
		for(let i = 0; i < allEmails.length; i++){
			let currentEmail = allEmails[i]
			// Unbold text
			if(currentEmail.firstChild.nodeName === 'b' || currentEmail.firstChild.nodeName === 'B'){
				currentEmail.innerHTML = currentEmail.innerText
			}
			// Bold text if match `email`
			if(currentEmail.innerText === email){
				currentEmail.innerHTML = '<b>' + currentEmail.innerText + '</b>'
			}
		}
	}
</script>
{% endblock %}

{% block styling %}
.center-text {
	text-align: center;
}
body {
    background: #F2F2F2;
}
table {
	table-layout: fixed;
	text-align: center;
}
tr, th, td {
    background-clip: padding-box;
}
th, td {
    width: 12%;
}
tr:not(:first-child) td:not(:first-child) {
    border-color: transparent;
    border-width: 2px;
    border-radius: 8px;
}
{% endblock %}

{% block content %}
<h1 id="meeting_name" class="text-center text-capitalize"></h1>

<br><br>

<div class="row">

    <!-- <div class="row" id="curr_table_type">
		Current table: In-person availability
	</div>
	<div class="row" id="change_table_div">
		<div class="col-3">
			<button type="button" class="btn btn-primary" id="change_table">Click to go to virtual availability</button>
		</div>
	</div> -->

    <div class="col-8">
        <div id="sched-results" class="container">
            <div class="row" id="curr_table_type">
                Current table: In-person availability
            </div>
            <div class="row" id="change_table_div">
                <div class="col-3">
                    <button type="button" class="btn btn-primary" id="change_table">Click to go to virtual availability</button>
                </div>
            </div>
            <div id="timeFormatSelector" class="btn-group col-4" style="padding-left: 0px">
                <label class="btn btn-light" onclick="reformatTimeDisplay('12h')">
                    <input type="radio" name="radio" checked> 12-hour </input>
                </label>
                <label class="btn btn-light" onclick="reformatTimeDisplay('24h')">
                    <input type="radio" name="radio"> 24-hour </input>
                </label>
            </div>

        </div>
    </div>


    <div class="col-4">
        <div class="row">
            <div class="col-6">
                <h4>Participants List</h4>
                <div id="users-list" class="container"></div>
            </div>

            <div class="col-6">
                <h4>Best Times</h4>
                <div id="best-times" class="container"></div>
            </div>
        </div>
        
        <div class="row" style="margin-top: 50px;"> <!-- Hard-coded margin-top for now. Needs to be changed. -->
            <div class="col-12">
                <h5>Click to copy/share meeting link:</h5>
                <p id="meetingId"></p>
                <button type="button" class="btn btn-primary" id="copyBtn">Copy Meeting ID</button>
            </div>
        </div>
        
        <div class="row" style="margin-top: 100px;"> <!-- Hard-coded margin-top for now. Needs to be changed. -->
            <div class="col-12">
                <button type="button" class="btn btn-primary" id="editingPage">Go back to Editing Page</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}